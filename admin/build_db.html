<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Datenbank erzeugen</title>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; }
  button { padding: 15px 25px; font-size: 18px; cursor: pointer; }
  #log { margin-top: 30px; white-space: pre-wrap; font-size: 14px; }
</style>
</head>
<body>

<h1>MarketShield Datenbank erzeugen</h1>
<p>Ein Klick erzeugt 100.000 hochwertige Einträge in einer einzigen Datei.</p>

<button onclick="build()">Datenbank erzeugen</button>

<div id="log"></div>

<script>
const USER = "LIGONE-token";
const REPO = "marketshield";
const FILEPATH = "data/entries.json";

async function build() {
    log("Erzeuge 100.000 Datensätze ...");

    const categories = [
        "zusatzstoffe","zucker","verpackung","verarbeitung","naehrstoffe",
        "konservierer","dufte","polymere","uvfilter","tenside",
        "strahlung","raumluft","reiniger","wasser","textilien",
        "schlaf","medikamente","stimulanzien","lebensstil","immunsystem",
        "abos","versicherungen","kredite","marketing","digitales",
        "kinder","senioren","tiere","umwelt","trends"
    ];

    function random(a) { return a[Math.floor(Math.random() * a.length)]; }

    log("Generiere Daten ...");

    const entries = [];

    for (let i = 1; i <= 100000; i++) {
        entries.push({
            id: String(i).padStart(6, "0"),
            title: "Eintrag " + i,
            category: random(categories),
            subcategory: "allgemein",
            risk_level: random(["sehr niedrig","niedrig","mittel","hoch","sehr hoch"]),
            ultra_processed_score: Math.floor(Math.random() * 6),
            processing_warning: "Kann in industriell verarbeiteten Produkten vorkommen.",
            description: "Automatisch erzeugter Datenbankeintrag für MarketShield.",
            health_effects: [
                "Kann bei empfindlichen Personen Auswirkungen haben",
                "Risiko hängt von Dosis und Gesamtexposition ab"
            ],
            alternatives: [
                "Natürlichere Alternativen bevorzugen",
                "Unververarbeitete Lebensmittel prüfen"
            ],
            sources: ["Verbraucherschutzberichte", "Fachartikel"],
            tags: ["info","auto"]
        });
    }

    log("JSON erzeugt. Lade hoch ...");

    const token = prompt("Bitte deinen GitHub Personal Access Token eingeben:");

    if (!token) {
        log("ABGEBROCHEN: Kein Token eingegeben.");
        return;
    }

    const upload = {
        message: "Automatisch erzeugte MarketShield-Datenbank",
        content: btoa(unescape(encodeURIComponent(JSON.stringify(entries, null, 2))))
    };

    const response = await fetch(
        `https://api.github.com/repos/${USER}/${REPO}/contents/${FILEPATH}`,
        {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(upload)
        }
    );

    if (response.ok) {
        log("✔ Erfolg! entries.json wurde hochgeladen.");
    } else {
        log("❌ Fehler: " + await response.text());
    }
}

function log(t) {
    document.getElementById("log").textContent += t + "\n";
}
</script>

</body>
</html>

